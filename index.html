<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sistema Bancário - Interface</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; max-width: 900px; margin: 20px auto; padding: 0 16px; }
    header { display:flex; align-items:center; justify-content:space-between; }
    h1 { font-size: 20px; }
    .card { border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-top: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.04); }
    label { display:block; margin-top:8px; font-weight:600; }
    input, select { width:100%; padding:8px; margin-top:6px; border-radius:4px; border:1px solid #ccc; }
    button { margin-top:10px; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
    .row { display:flex; gap:10px; }
    .row > * { flex:1; }
    pre { background:#fafafa; padding:8px; border-radius:6px; overflow:auto; }
  </style>
</head>
<body>
  <header>
    <h1>Sistema Bancário (Interface)</h1>
    <div>Trabalho Avaliação 2</div>
  </header>

  <section class="card">
    <h2>Criar Pessoa / Cliente</h2>
    <label>Nome<input id="inpNome" /></label>
    <label>CPF<input id="inpCpf" /></label>
    <label>Data Nascimento (YYYY/MM/DD)<input id="inpDt" placeholder="2000/01/01" /></label>
    <button id="btnCriarCliente">Criar Cliente</button>
  </section>

  <section class="card">
    <h2>Criar Conta</h2>
    <label>Tipo
      <select id="selTipo">
        <option value="corrente">Conta Corrente</option>
        <option value="poupanca">Poupança</option>
      </select>
    </label>
    <label>Titular (nome existente)<input id="inpTitular" placeholder="digite o nome exato do titular" /></label>
    <div class="row">
      <div>
        <label>Saldo inicial<input id="inpSaldo" type="number" step="0.01" /></label>
      </div>
      <div>
        <label id="lblLim">Limite / Aniversário<input id="inpLim" /></label>
      </div>
    </div>
    <button id="btnCriarConta">Criar Conta</button>
  </section>

  <section class="card">
    <h2>Ações</h2>
    <div class="row">
      <button id="btnListar">Listar Contas</button>
      <button id="btnViraMes">Executar viraMes() em todas</button>
      <button id="btnPesquisar">Pesquisar por nome/CPF</button>
    </div>
    <label>Pesquisa<input id="inpPesquisa" /></label>
  </section>

  <section class="card">
    <h2>Saída</h2>
    <pre id="output" style="height:300px"></pre>
  </section>

  <script type="module">
    import { Cliente } from "./Cliente.js";
    import { Pessoa } from "./Pessoa.js";
    import { ContaCorrente } from "./ContaCorrente.js";
    import { Poupanca } from "./Poupanca.js";

    // armazenamento simples em memória
    const clientes = [];
    const contas = [];

    // helpers
    function findClienteByName(nome) {
      return clientes.find(c => c.nome.toUpperCase() === (nome||"").toUpperCase());
    }

    function appendOutput(txt) {
      const out = document.getElementById('output');
      out.textContent = txt + "\n\n" + out.textContent;
    }

    // elementos
    const btnCriarCliente = document.getElementById('btnCriarCliente');
    const btnCriarConta = document.getElementById('btnCriarConta');
    const btnListar = document.getElementById('btnListar');
    const btnViraMes = document.getElementById('btnViraMes');
    const btnPesquisar = document.getElementById('btnPesquisar');
    const selTipo = document.getElementById('selTipo');
    const lblLim = document.getElementById('lblLim');
    const inpLim = document.getElementById('inpLim');

    selTipo.addEventListener('change', () => {
      if (selTipo.value === 'corrente') {
        lblLim.textContent = 'Limite (ex: 200.00)';
        inpLim.type = 'number';
        inpLim.value = '';
      } else {
        lblLim.textContent = 'Aniversário (1-31)';
        inpLim.type = 'number';
        inpLim.value = '';
      }
    });

    btnCriarCliente.addEventListener('click', () => {
      const nome = document.getElementById('inpNome').value;
      const cpf = document.getElementById('inpCpf').value;
      const dt = document.getElementById('inpDt').value || '2000/01/01';
      if (!nome || !cpf) { alert('Nome e CPF obrigatórios'); return; }
      const c = new Cliente(nome, cpf, dt);
      clientes.push(c);
      appendOutput('Cliente criado:\n' + c.toString());
      document.getElementById('inpNome').value = '';
      document.getElementById('inpCpf').value = '';
      document.getElementById('inpDt').value = '';
    });

    btnCriarConta.addEventListener('click', () => {
      const tipo = selTipo.value;
      const titularNome = document.getElementById('inpTitular').value;
      const saldo = parseFloat(document.getElementById('inpSaldo').value) || 0.0;
      const limVal = document.getElementById('inpLim').value;
      const titular = findClienteByName(titularNome);
      if (!titular) { alert('Titular não encontrado. Crie o cliente primeiro e use o nome exato.'); return; }

      let conta;
      if (tipo === 'corrente') {
        const limite = parseFloat(limVal) || 0.0;
        conta = new ContaCorrente(titular, saldo, limite);
      } else {
        const aniversario = parseInt(limVal) || 1;
        conta = new Poupanca(titular, saldo, aniversario);
      }
      contas.push(conta);
      appendOutput('Conta criada:\n' + conta.toString());
      document.getElementById('inpTitular').value = '';
      document.getElementById('inpSaldo').value = '';
      document.getElementById('inpLim').value = '';
    });

    btnListar.addEventListener('click', () => {
      if (contas.length === 0) { appendOutput('Nenhuma conta cadastrada.'); return; }
      let txt = '--- LISTAGEM DE CONTAS ---\n';
      contas.forEach((c, i) => {
        txt += `--- Conta ${i+1} ---\n${c.toString()}\n\n`;
      });
      appendOutput(txt);
    });

    btnViraMes.addEventListener('click', () => {
      contas.forEach(c => c.viraMes());
      appendOutput('viraMes() executado em todas as contas.');
    });

    btnPesquisar.addEventListener('click', () => {
      const termo = document.getElementById('inpPesquisa').value || '';
      const termoUpper = termo.toString().toUpperCase();
      const encontrados = contas.filter(c => {
        const nome = c.titular?.nome?.toString().toUpperCase() ?? '';
        const cpf = c.titular?.cpf?.toString() ?? '';
        return nome.includes(termoUpper) || cpf.includes(termo);
      });
      if (encontrados.length === 0) appendOutput('Nenhuma conta encontrada para: ' + termo);
      else {
        let txt = `--- RESULTADO DA PESQUISA (${termo}) ---\n`;
        encontrados.forEach(c => txt += c.toString() + '\n\n');
        appendOutput(txt);
      }
    });

    // demo inicial (cria alguns clientes e contas)
    (function demo() {
      const a = new Cliente('Ana Silva', '11122233344', '1990/05/10');
      const b = new Cliente('Bruno Souza', '55566677788', '1992/08/21');
      const c = new Pessoa('Carlos Pereira', '99988877766');
      clientes.push(a,b,c);

      const cc1 = new ContaCorrente(a, 500.0, 200.0);
      const cc2 = new ContaCorrente(b, 0.0, 100.0);
      const cp1 = new Poupanca(a, 1000.0, 5);
      const cp2 = new Poupanca(c, 300.0, 10);
      contas.push(cc1, cc2, cp1, cp2);

      appendOutput('Demo inicial criada com 3 clientes e 4 contas.');
    })();

  </script>
</body>
</html>
